<!DOCTYPE html>
<html>
	<head lang="en">
		<meta charset="utf-8" />
		<title>个人信息</title>
		<link rel="stylesheet" type="text/css" href="css/public.css"/>
		<link rel="stylesheet" type="text/css" href="css/myorder.css" />
		<script src="js/vue.min.js"></script>
		<script src="js/axios.min.js"></script>
	</head>
	<body>
		<div id="app">
			<!------------------------------head------------------------------>
		<div class="head ding">
			<div class="wrapper clearfix">
				<div class="clearfix" id="top">
					<h1 class="fl"><a href="index.html"><img src="img/logo1.png" style="width:200px;height:60px;"/></a></h1>
				</div>					
			</div>
		</div>
		<!------------------------------idea------------------------------>
		<div class="address mt">
			<div class="wrapper clearfix">
				<a href="index.html" class="fl">首页</a>
				<span>/</span>
				<a href="myorderq.html" class="on">我的订单</a>
				<span>/</span>
				<a href="#" class="on">订单详情</a>
			</div>
		</div>
		
		<!------------------------------Bott------------------------------>
		<div class="Bott">
			<div class="wrapper clearfix">
				<div class="zuo fl">
					<h3>
						<a href="mygxin.html"><img :src="user.avatar" width="92px" height="92px"/></a>
						<p class="clearfix"><span>[{{user.userName}}]</span>
							<br>
							<span @click="logout()">[退出登录]</span>
						</p>
					</h3>
					<div>
						<h4>我的交易</h4>
						<ul>
							<li><a href="cart.html">我的购物车</a></li>
							<li><a href="myproducts.html">我的闲置</a></li>
							<li><a href="myorderq.html">我的订单</a></li>
						</ul>
						<h4>个人中心</h4>
						<ul>
							<li  class="on"><a href="mygxin.html">我的中心</a></li>
							<li><a href="address.html">地址管理</a></li>
						</ul>
						<h4>账户管理</h4>
						<ul>
							<li><a href="mygrxx.html">个人信息</a></li>
							<li><a href="remima.html">修改密码</a></li>
						</ul>
					</div>
				</div>
				<div class="you fl">
					<div class="my clearfix">
						<h2>订单详情<a href="#">请谨防钓鱼链接或诈骗电话，了解更多&gt;</a></h2>
						<h3>订单号：<span>{{order.orderID}}</span></h3>
					</div>
					<div class="orderList">
						<div class="orderList1">
							<h3>已付款</h3>
							<div class="clearfix">
								<a href="#" class="fl"><img :src="order.productImg" style="width: 65px;height: 65px;"/></a>
								<p class="fl"><a href="#">{{order.productName}}</a><a href="#">¥{{order.unitPrice}}×{{order.number}}</a></p>
							</div>
						</div>
						<div class="orderList1">
							<h3>收货信息</h3>
							<p>姓 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名：<span>{{order.receivePeople}}</span></p>
							<p>联系电话：<span>{{order.phone}}</span></p>
							<p>收货地址：<span>{{order.address}}</span></p>
						</div>
						<div class="orderList1">
							<h3>支付方式及送货时间</h3>
							<p>支付方式：<span>在线支付</span></p>
							<p>送货时间：<span>不限送货时间</span></p>
						</div>
						<div class="orderList1 hei">
							<h3><strong>商品总价：</strong><span>¥{{order.totalPrice}}</span></h3>
							<p><strong>运费：</strong><span>¥0</span></p>
							<p><strong>订单金额：</strong><span>¥{{order.totalPrice}}</span></p>
							<p><strong>实付金额：</strong><span>¥{{order.totalPrice}}</span></p>
						</div>
						
					</div>
					
					
				</div>
			</div>
		</div>
		<
		
		<!--返回顶部-->
		<div class="gotop">
			<a href="cart.html">
			<dl>
				<dt><img src="img/gt1.png"/></dt>
				<dd>去购<br />物车</dd>
			</dl>
			</a>
			<a href="#" class="dh">
			<dl>
				<dt><img src="img/gt2.png"/></dt>
				<dd>联系<br />客服</dd>
			</dl>
			</a>
			<a href="mygxin.html">
			<dl>
				<dt><img src="img/gt3.png"/></dt>
				<dd>个人<br />中心</dd>
			</dl>
			</a>
			<a href="#" class="toptop" style="display: none">
			<dl>
				<dt><img src="img/gt4.png"/></dt>
				<dd>返回<br />顶部</dd>
			</dl>
			</a>
			<p>400-800-8200</p>
		</div>
		<!--footer-->
		<div class="footer">
			<div class="top">
				<div class="wrapper">
					<div class="clearfix">
						<a href="#2" class="fl"><img src="img/foot1.png"/></a>
						<span class="fl">7天无理由退货</span>
					</div>
					<div class="clearfix">
						<a href="#2" class="fl"><img src="img/foot2.png"/></a>
						<span class="fl">15天免费换货</span>
					</div>
					<div class="clearfix">
						<a href="#2" class="fl"><img src="img/foot3.png"/></a>
						<span class="fl">满599包邮</span>
					</div>
					<div class="clearfix">
						<a href="#2" class="fl"><img src="img/foot4.png"/></a>
						<span class="fl">手机特色服务</span>
					</div>
				</div>
			</div>
			<p class="dibu">PurchaSaler&copy;2019-2020公司版权所有 京ICP备080100-44备0000111000号<br />
			违法和不良信息举报电话：400-800-8200，本网站所列数据，除特殊说明，所有数据均出自我司实验室测试</p>
		</div>
		</div>		
	</body>
	<script src="js/jquery-1.12.4.min.js"></script>
	<script>
		var vue = new Vue({
			el:'#app',
			data() {
				return {
					user:[],
					order:[],
				}
			},
			mounted(){
				//获取个人信息
				this.get();
				//获取订单
				var oid = this.getUrlParam('oid');
				this.getOrderDetail(oid);
			},
			methods: {
				get(){
					axios({
						method:'get',
						url:'http://localhost:5000/api/Users/UserInfo',
						headers:{
							'Authorization': "Bearer"+" "+ localStorage['token']
						}
					})
					.then(function(res){
						vue.user = res.data;
						console.log(vue.user);
					})
					.catch(function(error){
						alert("您的token已失效，请重新登录");
						window.location.href="login.html";
					});
				},
				logout(){
					localStorage.setItem("token","");
					alert("您已退出，点击返回首页");
					window.location.href="index.html";
				},
				//获取订单id				
				getUrlParam(name) {
                 //构造一个含有目标参数的正则表达式对象
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                //匹配目标参数
                var r = window.location.search.substr(1).match(reg);
                //返回参数值
                if (r != null) return unescape(r[2]); return null; 
				},
				//获取订单明细
				getOrderDetail(oid){
					axios({
						method:'post',
						url:'http://localhost:5000/api/Orders/GetOrderDetail',
						data:{
							id:parseInt(oid)
						}
					})
					.then(function(res){
						vue.order = res.data;
						console.log(res.data);
					})
					.catch(function(error){
						console.log(error);
					});
				},				
			},
		});
	</script>
</html>
