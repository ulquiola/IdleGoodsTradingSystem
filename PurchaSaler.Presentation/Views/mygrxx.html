<!DOCTYPE html>
<html>
	<head lang="en">
		<meta charset="utf-8" />
		<title>个人信息</title>
		<link rel="stylesheet" type="text/css" href="css/public.css"/>
		<link rel="stylesheet" type="text/css" href="css/mygrxx.css" />
		<script src="js/vue.min.js"></script>
		<script src="js/axios.min.js"></script>
	</head>
	<body>
		<!------------------------------head------------------------------>
		<div class="head ding">
			<div class="wrapper clearfix">
				<div class="clearfix" id="top">
					<h1 class="fl"><a href="index.html"><img src="img/logo1.png" style="width:200px;height:60px;"/></a></h1>
				</div>					
			</div>
		</div>
		<!------------------------------idea------------------------------>
		<div class="address mt">
			<div class="wrapper clearfix">
				<a href="index.html" class="fl">首页</a>
				<span>/</span>
				<a href="mygxin.html" class="on">个人信息</a>
			</div>
		</div>
		
		<div id="app">
			<!------------------------------Bott------------------------------>
		<div class="Bott">
			<div class="wrapper clearfix">
				<div class="zuo fl">
					<h3>
						<a href="mygxin.html"><img :src="user.avatar" width="92px" height="92px"/></a>
						<p class="clearfix"><span>[{{user.userName}}]</span>
							<br>
							<span @click="logout()">[退出登录]</span>
						</p>
					</h3>
					<div>
						<h4>我的交易</h4>
						<ul>
							<li><a href="cart.html">我的购物车</a></li>
							<li><a href="myproducts.html">我的闲置</a></li>
							<li><a href="myorderq.html">我的订单</a></li>
						</ul>
						<h4>个人中心</h4>
						<ul>
							<li  class="on"><a href="mygxin.html">我的中心</a></li>
							<li><a href="address.html">地址管理</a></li>
						</ul>
						<h4>账户管理</h4>
						<ul>
							<li><a href="mygrxx.html">个人信息</a></li>
							<li><a href="remima.html">修改密码</a></li>
						</ul>
					</div>
				</div>
				<div class="you fl">
					<h2>个人信息</h2>
					<div class="gxin">
						<div class="tx"><a href="#"><img :src="user.avatar" width="92px" height="92px"/><p id="avatar">修改头像</p></a></div>
						<div class="xx">
							<h3 class="clearfix"><strong class="fl">基础资料</strong><a href="#" class="fr" id="edit1">编辑</a></h3>
							<div>姓名：{{user.name}}</div>
							<div>性别：{{user.sex}}</div>
							<div>出生日期：{{user.birthday}}</div>
							<div>邮箱：{{user.email}}</div>							
						</div>
					</div>			
				</div>
			</div>
		</div>
		<!--遮罩-->
		<div class="mask"></div>
		<!--编辑弹框-->
		<div class="bj">
			<!-- <div class="clearfix"><a href="#" class="fr gb"><img :src="user.avatar" width="92px" height="92px"/></a></div> -->
			<h3>编辑基础资料</h3>
			<form action="#" method="get">
				<p><label>姓名：</label><input v-model="name" type="text" :value="user.name" /></p>
				<p><label>生日：</label><input v-model="birthday" type="text" :value="user.birthday"  /></p>
				<p>
					<label>性别：</label>
					<span><input type="radio" value="男" v-model="sex"/>男</span>
					<span><input type="radio" value="女" v-model="sex"/>女</span>
					<span><input type="radio" value="保密" v-model="sex"/>保密</span>
				</p>
				<p><label>邮箱：</label><input v-model="email" type="text" :value="user.email" /></p>
				<div class="bc">
					<input type="button" value="保存" @click="updateInfo()" />
					<input class="gb" type="button" value="取消" />
				</div>
			</form>
		</div>
		
		<div class="avatar">
			<!-- <div class="clearfix"><a href="#" class="fr gb"><img :src="user.avatar" width="92px" height="92px"/></a></div> -->
			<h3>修改头像</h3>
			<form action="#" method="post">
				<h4>请上传图片</h4>
				<input accept="image/jpg,image/png" ref="file" type="file" value="上传头像" />
				<p>jpg或png，大小不超过2M</p>
				<input type="button" value="提交" @click="uploadAvatar()" /><br>
				<input class="gb" type="button" value="取消" />
			</form>
		</div>
		</div>
		
		<!--返回顶部-->
		<div class="gotop">
			<a href="cart.html">
			<dl>
				<dt><img src="img/gt1.png"/></dt>
				<dd>去购<br />物车</dd>
			</dl>
			</a>
			<a href="#" class="dh">
			<dl>
				<dt><img src="img/gt2.png"/></dt>
				<dd>联系<br />客服</dd>
			</dl>
			</a>
			<a href="mygxin.html">
			<dl>
				<dt><img src="img/gt3.png"/></dt>
				<dd>个人<br />中心</dd>
			</dl>
			</a>
			<a href="#" class="toptop" style="display: none">
			<dl>
				<dt><img src="img/gt4.png"/></dt>
				<dd>返回<br />顶部</dd>
			</dl>
			</a>
			<p>400-800-8200</p>
		</div>
		<!--footer-->
		<div class="footer">
			<div class="top">
				<div class="wrapper">
					<div class="clearfix">
						<a href="#2" class="fl"><img src="img/foot1.png"/></a>
						<span class="fl">7天无理由退货</span>
					</div>
					<div class="clearfix">
						<a href="#2" class="fl"><img src="img/foot2.png"/></a>
						<span class="fl">15天免费换货</span>
					</div>
					<div class="clearfix">
						<a href="#2" class="fl"><img src="img/foot3.png"/></a>
						<span class="fl">满599包邮</span>
					</div>
					<div class="clearfix">
						<a href="#2" class="fl"><img src="img/foot4.png"/></a>
						<span class="fl">手机特色服务</span>
					</div>
				</div>
			</div>
			<p class="dibu">最家家居&copy;2013-2017公司版权所有 京ICP备080100-44备0000111000号<br />
			违法和不良信息举报电话：400-800-8200，本网站所列数据，除特殊说明，所有数据均出自我司实验室测试</p>
		</div>
	</body>
	<script src="js/jquery-1.12.4.min.js"></script>
	<script>
		var vue = new Vue({
			el:"#app",
			data() {
				return {
					user:[],					
					name:"",
					birthday:"",
					sex:"保密",
					email:"",
					file:"",
				}
			},
			mounted(){
				//获取用户信息
				this.get();
				//	个人信息 编辑
				$("#edit1").click(function(){
					$(".mask").show();
					$(".bj").show();
				});				
				
				//修改头像
				$("#avatar").click(function(){
					$(".mask").show();
					$(".avatar").show();
				});
				//关闭弹窗
				$(".gb").click(function(){
					$(".mask").hide();
					$(".bj").hide();
					$(".avatar").hide();
				});
			}
			,			
			methods: {
				get(){
					axios.get("http://localhost:5000/api/Users/UserInfo",{
						headers:{
                    		'Authorization': "Bearer"+" "+ localStorage['token']
                   		}
					})
					.then(function(res){
						vue.user = res.data;
						vue.name = vue.user.name;
						vue.birthday = vue.user.birthday;
						vue.sex = vue.user.sex;
						vue.email = vue.user.email;
						// console.log(vue.user);
					})
					.catch(function(error){
						alert("您的token已失效，请重新登录");
						window.location.href="login.html";
					});
				},
				logout(){
					localStorage.setItem("token","");
					alert("您已退出，点击返回首页");
					window.location.href="index.html";
				},
				updateInfo(){
					var thisVue = this;
					axios.post("http://localhost:5000/api/Users/UpdateInfo",
						{						
							name:thisVue.name,
							birthday:thisVue.birthday,
							sex:thisVue.sex,
							email:thisVue.email,	
						},
						{
							headers:{
							'Authorization': "Bearer"+" "+ localStorage['token'],
							"Content-Type" : "application/json",
							},							
						}
					)
					.then(function(res){
						alert("修改成功");
						window.location.href="mygrxx.html"
					})
					.catch(function(error){
						alert("您的token已失效，请重新登录");
						window.location.href="login.html";
					});
				},
				uploadAvatar(){
					vue.file = this.$refs.file.files[0];
					let formData = new FormData();
					formData.append('file', vue.file);
					axios.post("http://localhost:5000/api/Users/UpdateAvatar",formData,{
						headers: {
							'Authorization': "Bearer"+" "+ localStorage['token'],
							'Content-Type': 'multipart/form-data'
						},
					})
					.then(function(res){
						alert("头像修改成功")
						window.location.href="mygrxx.html";
					})
					.catch(function(error){
						alert("您的token已失效，请重新登录");
						window.location.href="login.html";
					});   
				},
			},

		});
	</script>
</html>
